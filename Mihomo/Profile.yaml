# > ğ¥ğšğ¨ğ¬ğ¡ğ®@Mihomo è‡ªç”¨é…ç½® (Optimized)
# > ä¼˜åŒ–å†…å®¹ï¼šå¼€å¯ Snifferã€å¢åŠ  Geosite è§„åˆ™ã€ä¼˜åŒ– DNS ä¸ç¼“å­˜è·¯å¾„
# > Update: 2025.10.16

# --- åŸºç¡€è®¾ç½® ---
mode: rule
ipv6: true
log-level: info # warning æœ‰æ—¶ä¼šæ¼æ‰å…³é”®æ’æŸ¥ä¿¡æ¯ï¼Œå»ºè®® info
allow-lan: true
mixed-port: 7893
bind-address: '*'
find-process-mode: strict # strict æ¯” always æ›´ç²¾å‡†ä¸”å ç”¨ä½
global-client-fingerprint: chrome

# --- æ€§èƒ½ä¸è¿æ¥ ---
keep-alive-interval: 15
keep-alive-idle: 600
tcp-concurrent: true
unified-delay: true

# --- å¤–éƒ¨èµ„æºæ›´æ–° ---
profile:
  store-selected: true
  store-fake-ip: true
geo-auto-update: true
geo-update-interval: 24
geodata-mode: true
geox-url:
  geoip: "https://raw.githubusercontent.com/Loyalsoldier/geoip/release/geoip.dat"
  geosite: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/releases/download/latest/geosite.dat"
  mmdb: "https://raw.githubusercontent.com/Loyalsoldier/geoip/release/Country.mmdb"

# --- å…³é”®ä¼˜åŒ–ï¼šå—…æ¢å™¨ ---
sniffer:
  enable: true  # å¿…é¡»å¼€å¯ï¼Œå¦åˆ™ fake-ip ä¸‹éƒ¨åˆ†åˆ†æµä¼šå¤±æ•ˆ
  parse-pure-ip: true
  override-destination: true
  force-dns-mapping: true
  sniff:
    HTTP: { ports: [80, 8080-8880], override-destination: true }
    TLS: { ports: [443, 8443], override-destination: true }
    QUIC: { ports: [443, 8443], override-destination: true }

# --- Tun æ¨¡å¼ ---
tun:
  enable: true
  stack: mixed # æˆ– gvisor
  auto-route: true
  auto-redirect: true
  auto-detect-interface: true
  dns-hijack:
    - "any:53"
    - "tcp://any:53"

# --- DNS è®¾ç½® ---
dns:
  enable: true
  ipv6: true
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  prefer-h3: true # å¼€å¯ DoH çš„ HTTP/3 æ”¯æŒ
  default-nameserver:
    - 223.5.5.5
    - 119.29.29.29
  nameserver:
    - https://dns.alidns.com/dns-query
    - https://doh.pub/dns-query
  #  fallback: # å¯é€‰ï¼šå›½å¤– DNS ä½œä¸ºåå¤‡
  #   - https://8.8.8.8/dns-query
  fake-ip-filter:
    - "*"
    - "+.lan"
    - "+.local"
    - "stun.*"
    - "time.*.com"
    - "ntp.*.com"
    - "+.msftconnecttest.com"
    - "+.msftncsi.com"

# --- é”šç‚¹ (Anchors) ---
p: &p 
  type: http
  interval: 86400
  health-check: {enable: true, url: https://www.google.com/generate_204, interval: 300, timeout: 5000}

pg: &pg {type: select, proxies: [Proxy, é¦™æ¸¯èŠ‚ç‚¹, ç¾å›½èŠ‚ç‚¹, ç‹®åŸèŠ‚ç‚¹, æ—¥æœ¬èŠ‚ç‚¹, å°æ¹¾èŠ‚ç‚¹, éŸ©å›½èŠ‚ç‚¹, DIRECT]}

# ä¼˜åŒ–ç­–ç•¥ï¼šurl-test é—´éš”æ”¹ä¸º 300s é¿å…è¿‡äºé¢‘ç¹åˆ‡æ¢ï¼Œtolerance å¢åŠ åˆ° 50ms é¿å…å› å¾®å°æ³¢åŠ¨åˆ‡èŠ‚ç‚¹
url-test: &url-test {type: url-test, url: https://www.google.com/generate_204, interval: 300, tolerance: 50, include-all: true}
c: &c {type: http, behavior: classical, format: yaml, interval: 86400} # å»ºè®® format æ”¹ä¸º yamlï¼Œæ›´ç¨³å¥

# --- ä»£ç†æä¾›å•† ---
proxy-providers:
  Subscribe:
    url: http://127.0.0.1:38324/download/collection/AllServer # ç¡®ä¿ä½ æœ¬åœ°å¼€å¯äº†æ­¤æœåŠ¡
    path: ./proxy_providers/Subscribe.yaml # æ·»åŠ æœ¬åœ°ç¼“å­˜è·¯å¾„
    <<: *p

# --- ç­–ç•¥ç»„ ---
proxy-groups:
  - {name: é¦™æ¸¯èŠ‚ç‚¹, <<: *url-test, filter: "(?i)ğŸ‡­ğŸ‡°|é¦™æ¸¯|(\b(HK|Hong|HKG)\b)", icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/HongKong.png}
  - {name: ç¾å›½èŠ‚ç‚¹, <<: *url-test, filter: "(?i)ğŸ‡ºğŸ‡¸|ç¾å›½|æ³¢ç‰¹å…°|è¾¾æ‹‰æ–¯|ä¿„å‹’å†ˆ|å‡¤å‡°åŸ|è´¹åˆ©è’™|ç¡…è°·|æ‹‰æ–¯ç»´åŠ æ–¯|æ´›æ‰çŸ¶|åœ£ä½•å¡|åœ£å…‹æ‹‰æ‹‰|è¥¿é›…å›¾|èŠåŠ å“¥|(\b(US|United States|American|USA|SJC|JFK|LAX|ORD|ATL|DFW|SFO|MIA|SEA|IAD)\b)", icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/UnitedStates.png}
  - {name: ç‹®åŸèŠ‚ç‚¹, <<: *url-test, filter: "(?i)ğŸ‡¸ğŸ‡¬|æ–°åŠ å¡|ç‹®|(\b(SG|Singapore|SIN|XSP)\b)", icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Singapore.png}
  - {name: æ—¥æœ¬èŠ‚ç‚¹, <<: *url-test, filter: "(?i)ğŸ‡¯ğŸ‡µ|æ—¥æœ¬|å·æ—¥|ä¸œäº¬|å¤§é˜ª|æ³‰æ—¥|åŸ¼ç‰|(\b(JP|Japan|NRT|HND|KIX|CTS|FUK)\b)", icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Japan.png}
  - {name: å°æ¹¾èŠ‚ç‚¹, <<: *url-test, filter: "(?i)ğŸ‡¹ğŸ‡¼|ğŸ‡¹ğŸ‡¼|å°æ¹¾|(\b(TW|Tai|TPE|Taiwan|TSA|KHH)\b)", icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Taiwan.png}
  - {name: éŸ©å›½èŠ‚ç‚¹, <<: *url-test, filter: "(?i)ğŸ‡°ğŸ‡·|éŸ©å›½|éŸ“|é¦–å°”|å—æœé²œ|(\b(KR|KOR|Korea|South)\b)", icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Korea.png}
  - {name: Proxy, type: select, include-all: true, proxies: [é¦™æ¸¯èŠ‚ç‚¹, ç¾å›½èŠ‚ç‚¹, ç‹®åŸèŠ‚ç‚¹, æ—¥æœ¬èŠ‚ç‚¹, å°æ¹¾èŠ‚ç‚¹, éŸ©å›½èŠ‚ç‚¹, DIRECT], icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Proxy.png}
  
  # åº”ç”¨åˆ†ç»„
  - {name: AIGC, <<: *pg, icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/ChatGPT.png}
  - {name: Apple, <<: *pg, icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Apple.png}
  - {name: Disney, <<: *pg, icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Disney.png} 
  - {name: Github, <<: *pg, icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/GitHub.png}  
  - {name: Google, <<: *pg, icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Google.png}
  - {name: HBO, <<: *pg, icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/HBO.png}
  - {name: Microsoft, <<: *pg, icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Microsoft.png}
  - {name: Netflix, <<: *pg, icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Netflix.png} 
  - {name: OneDrive, <<: *pg, icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/OneDrive.png}  
  - {name: PayPal, <<: *pg, icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/PayPal.png}  
  - {name: Spotify, <<: *pg, icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Spotify.png}
  - {name: Telegram, <<: *pg, icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Telegram.png}
  - {name: TikTok, <<: *pg, icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/TikTok.png}   
  - {name: Twitter, <<: *pg, icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Twitter.png}
  - {name: WeChat, <<: *pg, icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/WeChat.png }
  - {name: YouTube, <<: *pg, icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/YouTube.png}  
  - {name: Final, <<: *pg, include-all: true, icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Final.png}

# --- è§„åˆ™é›† (å¢åŠ äº† path ä»¥å®ç°æœ¬åœ°ç¼“å­˜) ---
rule-providers:
  Reject: {<<: *c, path: ./ruleset/Reject.yaml, url: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Reject.yaml}
  AIGC: {<<: *c, path: ./ruleset/AIGC.yaml, url: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/AIGC.yaml}  
  AppleCN: {<<: *c, path: ./ruleset/AppleCN.yaml, url: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Apple.yaml}
  AppleProxy: {<<: *c, path: ./ruleset/AppleProxy.yaml, url: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/AppleProxy.yaml}
  Disney: {<<: *c, path: ./ruleset/Disney.yaml, url: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Disney.yaml}
  Github: {<<: *c, path: ./ruleset/Github.yaml, url: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Github.yaml}
  Google: {<<: *c, path: ./ruleset/Google.yaml, url: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Google.yaml}
  HBO: {<<: *c, path: ./ruleset/HBO.yaml, url: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/HBO.yaml}
  Microsoft: {<<: *c, path: ./ruleset/Microsoft.yaml, url:https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Microsoft.yaml}
  Netflix: {<<: *c, path: ./ruleset/Netflix.yaml, url: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Netflix.yaml}  
  OneDrive: {<<: *c, path: ./ruleset/OneDrive.yaml, url: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/OneDrive.yaml}
  PayPal: {<<: *c, path: ./ruleset/PayPal.yaml, url: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/PayPal.yaml}
  Spotify: {<<: *c, path: ./ruleset/Spotify.yaml, url: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Spotify.yaml}  
  Telegram: {<<: *c, path: ./ruleset/Telegram.yaml, url: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Telegram.yaml}
  Twitter: {<<: *c, path: ./ruleset/Twitter.yaml, url: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Twitter.yaml}
  TikTok: {<<: *c, path: ./ruleset/TikTok.yaml, url: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/TikTok.yaml}
  WeChat: {<<: *c, path: ./ruleset/WeChat.yaml, url: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/WeChat.yaml}  
  YouTube: {<<: *c, path: ./ruleset/YouTube.yaml, url: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/YouTube.yaml}
  Proxy: {<<: *c, path: ./ruleset/Proxy.yaml, url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Proxy/Proxy_Classical_No_Resolve.yaml}  
  Direct: {<<: *c, path: ./ruleset/Direct.yaml, url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Direct/Direct.yaml}
  Lan: {<<: *c, path: ./ruleset/Lan.yaml, url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Lan/Lan.yaml}  
  China: {<<: *c, path: ./ruleset/China.yaml, url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/refs/heads/master/rule/Clash/ChinaMax/ChinaMax_Classical.yaml}

# --- è§„åˆ™é€»è¾‘ ---
rules: 
  - RULE-SET,Reject,REJECT  
  - RULE-SET,AIGC,AIGC
  - RULE-SET,AppleCN,DIRECT
  - RULE-SET,AppleProxy,Proxy
  - RULE-SET,Disney,Disney  
  - RULE-SET,Github,Github
  - RULE-SET,Google,Google
  - RULE-SET,HBO,HBO
  - RULE-SET,Microsoft,Microsoft
  - RULE-SET,Netflix,Netflix  
  - RULE-SET,OneDrive,OneDrive
  - RULE-SET,PayPal,PayPal   
  - RULE-SET,Spotify,Spotify
  - RULE-SET,Telegram,Telegram
  - RULE-SET,Twitter,Twitter
  - RULE-SET,TikTok,TikTok
  - RULE-SET,WeChat,WeChat
  - RULE-SET,YouTube,YouTube
  - RULE-SET,Proxy,Proxy  
  - RULE-SET,Direct,DIRECT    
  - RULE-SET,Lan,DIRECT
  # ä¼˜åŒ–ç‚¹ï¼šå…ˆåŒ¹é… Geosite CNï¼Œå› ä¸ºæ¯” IP åŒ¹é…æ›´å¿«ä¸”æ—  DNS æ³„éœ²é£é™©
  - GEOSITE,CN,DIRECT
  - RULE-SET,China,DIRECT  
  - GEOIP,CN,DIRECT
  - MATCH,Final
