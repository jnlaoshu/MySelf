#!name=Spotify长期维护终极版
#!desc=长期维护稳定版：去广告+Premium增强+歌词翻译+低失效率+高稳定性
#!author=Long-Term Stable Integration
#!category=去广告
#!icon=https://raw.githubusercontent.com/luestr/IconResource/main/App_icon/120px/Spotify.png
#!date=2026-02-14

##############################
# Header Rewrite
##############################

[Header Rewrite]

# 防缓存导致功能失效
^https:\/\/api\.spotify\.com\/ request-header del if-none-match
^https:\/\/spclient\.wg\.spotify\.com\/ request-header del if-none-match
^https:\/\/.*-spclient\.spotify\.com\/ request-header del if-none-match


##############################
# Map Local
##############################

[Map Local]

# 广告系统
^https:\/\/.*spotify\.com\/ads data-type=text data="{}" status-code=200

# 广告配置
^https:\/\/.*spotify\.com\/pendragon data-type=text data="{}" status-code=200

# Banner广告
^https:\/\/spclient\.wg\.spotify\.com\/banner data-type=text data="{}" status-code=200

# 启动广告
^https:\/\/spclient\.wg\.spotify\.com\/startup data-type=text data="{}" status-code=200

# 推荐广告
^https:\/\/spclient\.wg\.spotify\.com\/recommendation data-type=text data="{}" status-code=200

# 播客广告
^https:\/\/spclient\.wg\.spotify\.com\/podcast-ad data-type=text data="{}" status-code=200


##############################
# Script
##############################

[Script]

######## Premium增强 ########

spotify-premium-bootstrap =
type=http-response,
pattern=^https:\/\/.*spotify\.com\/bootstrap,
requires-body=true,
binary-body-mode=true,
timeout=30,
script-path=https://raw.githubusercontent.com/app2smile/rules/master/js/spotify-proto.js

spotify-premium-user =
type=http-response,
pattern=^https:\/\/.*spotify\.com\/user-customization-service,
requires-body=true,
binary-body-mode=true,
timeout=30,
script-path=https://raw.githubusercontent.com/app2smile/rules/master/js/spotify-proto.js


######## 去广告 ########

spotify-adblock =
type=http-response,
pattern=^https:\/\/.*spotify\.com\/(bootstrap|user-customization-service),
requires-body=true,
binary-body-mode=true,
timeout=30,
script-path=https://kelee.one/Resource/JavaScript/Spotify/Spotify_remove_ads.js,
argument="[false,true]"


######## 歌词翻译 ########

spotify-track =
type=http-response,
pattern=^https:\/\/api\.spotify\.com\/v1\/tracks,
requires-body=true,
timeout=30,
script-path=https://kelee.one/Resource/JavaScript/Spotify/Spotify_response.js

spotify-lyrics-request =
type=http-request,
pattern=^https:\/\/spclient\.wg\.spotify\.com\/color-lyrics\/v2\/track,
requires-body=true,
timeout=30,
script-path=https://kelee.one/Resource/JavaScript/Spotify/Spotify_request.js

spotify-lyrics-translate =
type=http-response,
pattern=^https:\/\/spclient\.wg\.spotify\.com\/color-lyrics\/v2\/track,
requires-body=true,
binary-body-mode=true,
timeout=30,
script-path=https://kelee.one/Resource/JavaScript/Spotify/Translate_response.js


##############################
# Rule
##############################

[Rule]

AND,((DOMAIN-SUFFIX,spotify.com),(PROTOCOL,QUIC)),REJECT


##############################
# MITM
##############################

[MITM]

hostname = %APPEND% api.spotify.com, spclient.wg.spotify.com, *-spclient.spotify.com