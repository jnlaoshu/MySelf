# ğ„ğ ğğ«ğ§@ğ¥ğšğ¨ğ¬ğ¡ğ®ä¸“ç”¨é…ç½® 
# æ›´æ–°æ—¶é—´: 2026.01.02 15:49

# è‡ªåŠ¨æ›´æ–°é…ç½® (å¦‚éœ€å¯ç”¨è¯·å–æ¶ˆæ³¨é‡Š)
# auto_update:
#   url: https://raw.githubusercontent.com/jnlaoshu/MySelf/master/Egern/Profile.yaml
#   interval: 86400

# --- åŸºç¡€é…ç½® ---
ipv6: true
http_port: 3080
socks_port: 3090
allow_external_connections: true
vif_only: true
hide_vpn_icon: true

# --- DNS åŠ«æŒ ---
hijack_dns: 
  - '*:53'

# --- æ•°æ®åº“ URL é…ç½® ---
geoip_db_url: https://raw.githubusercontent.com/Loyalsoldier/geoip/release/Country.mmdb
asn_db_url: https://raw.githubusercontent.com/Loyalsoldier/geoip/release/GeoLite2-ASN.mmdb

# --- å»¶è¿Ÿæµ‹è¯• URL é…ç½® ---
proxy_latency_test_url: https://www.google.com/generate_204
direct_latency_test_url: http://www.apple.com/library/test/success.html

# --- è·¯ç”±é…ç½® ---
compat_route: false
include_all_networks: false
include_apns: false
include_cellular_services: false
include_local_networks: false

# --- DNS é…ç½® ---
dns:
  bootstrap:
    - 223.5.5.5
    - 119.29.29.29
    - 2400:3200::1
  upstreams:
    AdGuard:
      - quic://dns.adguard-dns.com
      - https://dns.adguard-dns.com/dns-query
    China:
      - https://dns.alidns.com/dns-query
      - https://doh.pub/dns-query
      - https://dns.pub/dns-query
    Global:
      - https://dns.google/dns-query
      - https://1.1.1.1/dns-query
  forward:
    - regex:
        match: ^ad(s?)\.
        value: AdGuard
    # æ³¨æ„ï¼šä½¿ç”¨ rule_set åˆ†æµ DNS ä¼šå¢åŠ å†…å­˜å¼€é”€ï¼Œå¦‚é‡å¡é¡¿å¯å°è¯•æ³¨é‡Šä¸‹æ–¹ block
    - proxy_rule_set:
        match: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/ChinaMax/ChinaMax_All.list
        value: China
    - wildcard:
        match: '*'
        value: Global
  public_ip_lookup_url: https://ifconfig.me/ip

# --- ç­–ç•¥ç»„é…ç½® ---
policy_groups:
  # è‡ªåŠ¨æµ‹é€Ÿåˆ†ç»„ 
  - auto_test:
      name: é¦™æ¸¯èŠ‚ç‚¹
      policies:
        - å…¨éƒ¨èŠ‚ç‚¹
      flatten: true
      filter: ğŸ‡­ğŸ‡°|é¦™æ¸¯|HK|Hong
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/HongKong.png
  - auto_test:
      name: ç¾å›½èŠ‚ç‚¹
      policies:
        - å…¨éƒ¨èŠ‚ç‚¹
      flatten: true
      filter: ğŸ‡ºğŸ‡¸|ç¾å›½|US|States|American
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/UnitedStates.png
  - auto_test:
      name: å°æ¹¾èŠ‚ç‚¹
      policies:
        - å…¨éƒ¨èŠ‚ç‚¹
      flatten: true
      filter: ğŸ‡¹ğŸ‡¼|å°æ¹¾|TW|Tai
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Taiwan.png
  - auto_test:
      name: æ—¥æœ¬èŠ‚ç‚¹
      policies:
        - å…¨éƒ¨èŠ‚ç‚¹
      flatten: true
      filter: ğŸ‡¯ğŸ‡µ|æ—¥æœ¬|JP|Japan
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Japan.png
  - auto_test:
      name: ç‹®åŸèŠ‚ç‚¹
      policies:
        - å…¨éƒ¨èŠ‚ç‚¹
      flatten: true
      filter: ğŸ‡¸ğŸ‡¬|æ–°åŠ å¡|ç‹®åŸ|SG|Singapore
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Singapore.png
  - auto_test:
      name: éŸ©å›½èŠ‚ç‚¹
      policies:
        - å…¨éƒ¨èŠ‚ç‚¹
      flatten: true
      filter: ğŸ‡°ğŸ‡·|éŸ©å›½|KR|KOR|Korea
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Korea.png

  # ç­›é€‰å‰©ä½™èŠ‚ç‚¹
  - select:
      name: å…¶ä»–èŠ‚ç‚¹
      policies:
        - å…¨éƒ¨èŠ‚ç‚¹
      flatten: true
      filter: ^((?!ğŸ‡­ğŸ‡°|é¦™æ¸¯|HK|Hong|ğŸ‡¹ğŸ‡¼|å°æ¹¾|TW|Tai|ğŸ‡¯ğŸ‡µ|æ—¥æœ¬|JP|Japan|ğŸ‡¸ğŸ‡¬|æ–°åŠ å¡|ç‹®åŸ|SG|Singapore|ğŸ‡°ğŸ‡·|éŸ©å›½|KR|KOR|Korea|ğŸ‡ºğŸ‡¸|ç¾å›½|US|States|American).)*$
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/WorldMap.png

  # å¤–éƒ¨è®¢é˜…æº
  - external:
      name: å…¨éƒ¨èŠ‚ç‚¹
      type: select
      urls:
        - https://sub.store/download/collection/AllServer?target=Egern
      icon: ğŸŒ¹ 

  # ä¸»æ‰‹åŠ¨åˆ‡æ¢ç­–ç•¥
  - select:
      name: è‡ªé€‰ç­–ç•¥
      policies:
        - é¦™æ¸¯èŠ‚ç‚¹
        - ç¾å›½èŠ‚ç‚¹
        - ç‹®åŸèŠ‚ç‚¹
        - å°æ¹¾èŠ‚ç‚¹
        - æ—¥æœ¬èŠ‚ç‚¹
        - éŸ©å›½èŠ‚ç‚¹
        - å…¶ä»–èŠ‚ç‚¹
        - DIRECT
      icon: ğŸ˜œ

  # åº”ç”¨ç­–ç•¥ç»„
  - select:
      name: AIGC
      policies:
        - è‡ªé€‰ç­–ç•¥
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/ChatGPT.png
  - select:
      name: Apple
      policies:
        - è‡ªé€‰ç­–ç•¥
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Apple.png
  - select:
      name: Disney
      policies:
        - è‡ªé€‰ç­–ç•¥
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Disney.png
  - select:
      name: GitHub
      policies:
        - è‡ªé€‰ç­–ç•¥
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/GitHub.png   
  - select:
      name: Google
      policies:
        - è‡ªé€‰ç­–ç•¥
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Google.png
  - select:
      name: HBO
      policies:
        - è‡ªé€‰ç­–ç•¥
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/HBO.png	
  - select:
      name: Microsoft
      policies:
        - è‡ªé€‰ç­–ç•¥
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Microsoft.png
  - select:
      name: Netflix
      policies:
        - è‡ªé€‰ç­–ç•¥
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Netflix.png	
  - select:
      name: PayPal
      policies:
        - è‡ªé€‰ç­–ç•¥
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/PayPal.png
  - select:
      name: Spotify
      policies:
        - è‡ªé€‰ç­–ç•¥
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Spotify.png    
  - select:
      name: Telegram
      policies:
        - è‡ªé€‰ç­–ç•¥
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Telegram.png
  - select:
      name: TikTok
      policies:
        - è‡ªé€‰ç­–ç•¥
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/TikTok.png    
  - select:
      name: Twitter
      policies:
        - è‡ªé€‰ç­–ç•¥
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Twitter.png
  - select:
      name: WeChat
      policies:
        - è‡ªé€‰ç­–ç•¥
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/WeChat.png
  - select:
      name: YouTube
      policies:
        - è‡ªé€‰ç­–ç•¥
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/YouTube.png
  - select:
      name: YouTubeMusic
      policies:
        - è‡ªé€‰ç­–ç•¥
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/YouTubeMusic.png

# --- ä»£ç†è§„åˆ™é…ç½® ---
# è§„åˆ™åŒ¹é…é¡ºåºéå¸¸é‡è¦ï¼Œå»ºè®®ï¼šå»å¹¿å‘Š -> å±€åŸŸç½‘/å›½å†…ç›´è¿ -> ç‰¹å®šAPPä»£ç† -> å…œåº•ä»£ç†
rules:
  # 1. å¼ºåˆ¶æ‹’ç»/æ‹¦æˆª (é«˜ä¼˜å…ˆçº§)
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Reject.yaml
      policy: REJECT
  - domain_regex:
      match: ^ad\..*|^ads\..*|^advert\..*
      policy: REJECT

  # 2. æœ¬åœ°ç½‘ç»œç›´è¿
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Lan.yaml
      policy: DIRECT

  # 3. å›½å†…æµé‡ç›´è¿
  - rule_set:
      match: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/ChinaMax/ChinaMax_All.list
      policy: DIRECT
      interval: 86400	
  - domain_suffix:
      match: '*.cn'
      policy: DIRECT
  - geoip:
      match: CN
      policy: DIRECT
      no_resolve: true

  # 4. ä¸“æœ‰æœåŠ¡/åº”ç”¨ä»£ç†
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Apple.yaml
      policy: Apple      
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/AppleProxy.yaml
      policy: é¦™æ¸¯èŠ‚ç‚¹
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/AIGC.yaml
      policy: AIGC
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Bing.yaml
      policy: ç¾å›½èŠ‚ç‚¹
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Disney.yaml
      policy: Disney
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Github.yaml
      policy: GitHub      
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Google.yaml
      policy: Google
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/HBO.yaml
      policy: HBO
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Microsoft.yaml
      policy: Microsoft
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Netflix.yaml
      policy: Netflix
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/PayPal.yaml
      policy: PayPal
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Spotify.yaml
      policy: Spotify
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Telegram.yaml
      policy: Telegram
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/TikTok.yaml
      policy: TikTok
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Twitter.yaml
      policy: Twitter
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/WeChat.yaml
      policy: WeChat
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/YouTube.yaml
      policy: YouTube
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/YouTubeMusic.yaml
      policy: YouTubeMusic

  # 5. å‰©ä½™ä»£ç†
  - rule_set:
      match: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Proxy/Proxy_All.list
      policy: è‡ªé€‰ç­–ç•¥
  
  # 6. æœ€ç»ˆé»˜è®¤ç­–ç•¥
  - default:
      policy: è‡ªé€‰ç­–ç•¥

# --- MITM é…ç½® ---
mitm:
  enabled: true
  ca_p12: egern.p12
  ca_passphrase: egern
  # å»ºè®®æ·»åŠ  hostnamesï¼Œè™½ç„¶ modules ä¼šè¦†ç›–ï¼Œä½†ä½œä¸º fallback æ›´å¥½
  hostnames:
    - '*.google.com'
    - '*.github.com'

# --- æ¨¡å—é…ç½® ---
modules:
  - url: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Module/Panel.yaml
    enabled: true
    interval: 3600
  - name: Sub-Store
    url: https://raw.githubusercontent.com/sub-store-org/Sub-Store/master/config/Egern.yaml
    enabled: true
  - name: WeatherKit    
    url: https://github.com/NSRingo/WeatherKit/releases/latest/download/iRingo.WeatherKit.sgmodule
    enabled: true    
  - name: 'Spotify'
    url: https://raw.githubusercontent.com/app2smile/rules/master/module/spotify.module
    enabled: true
  - name: 'YouTube Enhance'
    url: https://raw.githubusercontent.com/Maasea/sgmodule/master/YouTube.Enhance.sgmodule
    enabled: true
  - name: 'BiliBiliå»å¹¿å‘Š'
    url: https://raw.githubusercontent.com/app2smile/rules/master/module/bilibili.sgmodule
    enabled: true  
  - name: å¥¶æ€å¹¿å‘Šæ‹¦æˆª&å‡€åŒ–åˆé›†
    url: https://github.com/fmz200/wool_scripts/blob/main/Surge/module/blockAds.module
    enabled: true
    interval: 86400
