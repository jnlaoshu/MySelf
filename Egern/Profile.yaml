# ğ„ğ ğğ«ğ§@ğ¥ğšğ¨ğ¬ğ¡ğ®ä¸“ç”¨é…ç½®
# ä¼˜åŒ–æ—¶é—´: 2026.02.22 12:30

# è‡ªåŠ¨æ›´æ–°é…ç½® (å¦‚éœ€å¯ç”¨è¯·å–æ¶ˆæ³¨é‡Š)
# auto_update:
#   url: https://raw.githubusercontent.com/jnlaoshu/MySelf/master/Egern/Profile.yaml
#   interval: 86400

# --- åŸºç¡€é…ç½® ---
ipv6: true
http_port: 3080
socks_port: 3090
allow_external_connections: true
vif_only: true
hide_vpn_icon: true

# --- DNS åŠ«æŒ ---
hijack_dns:
  - '*:53'

# --- æ•°æ®åº“ ---
geoip_db_url: https://raw.githubusercontent.com/Loyalsoldier/geoip/release/Country.mmdb
asn_db_url: https://raw.githubusercontent.com/Loyalsoldier/geoip/release/GeoLite2-ASN.mmdb

# --- å»¶è¿Ÿæµ‹è¯• ---
proxy_latency_test_url: http://www.gstatic.com/generate_204
direct_latency_test_url: http://www.apple.com/library/test/success.html

# --- è·¯ç”±é€‰é¡¹ ---
compat_route: false
include_all_networks: false
include_apns: false
include_cellular_services: false
include_local_networks: false

# --- DNS é…ç½® ---
dns:
  bootstrap:
    - system
    - 223.5.5.5
    - 119.29.29.29
    - 2400:3200::1
  upstreams:
    AliDNS:
      - h3://dns.alidns.com/dns-query
    DNSPod:
      - https://doh.pub/dns-query
    Default:
      - https://doh.pub/dns-query
      - h3://dns.alidns.com/dns-query
  forward:
    # --- é˜¿é‡Œç³» (AliDNS) ---
    - domain_suffix:
        match: alibaba.com
        value: AliDNS
    - domain_suffix:
        match: alibabacloud.com
        value: AliDNS
    - domain_suffix:
        match: aliyun.com
        value: AliDNS
    - domain_suffix:
        match: alipay.com
        value: AliDNS
    - domain_suffix:
        match: taobao.com
        value: AliDNS
    - domain_suffix:
        match: tmall.com
        value: AliDNS
    - domain_suffix:
        match: amap.com
        value: AliDNS
    - domain_suffix:
        match: youku.com
        value: AliDNS
    - domain_suffix:
        match: dingtalk.com
        value: AliDNS
    - domain_suffix:
        match: ele.me
        value: AliDNS
    - domain_suffix:
        match: cainiao.com
        value: AliDNS
    - domain_suffix:
        match: hema.com
        value: AliDNS
    - domain_suffix:
        match: lazada.com
        value: AliDNS

    # --- è…¾è®¯ç³» (DNSPod) ---
    - domain_suffix:
        match: tencent.com
        value: DNSPod
    - domain_suffix:
        match: qq.com
        value: DNSPod
    - domain_suffix:
        match: wechat.com
        value: DNSPod
    - domain_suffix:
        match: weixin.qq.com
        value: DNSPod
    - domain_suffix:
        match: qcloud.com
        value: DNSPod
    - domain_suffix:
        match: cloudbase.net
        value: DNSPod
    - domain_suffix:
        match: weiyun.com
        value: DNSPod
    - domain_suffix:
        match: qpic.cn
        value: DNSPod
    - domain_suffix:
        match: gtimg.com
        value: DNSPod
    - domain_suffix:
        match: idqqimg.com
        value: DNSPod
    - domain_suffix:
        match: tim.qq.com
        value: DNSPod
    - domain_suffix:
        match: smoba.qq.com
        value: DNSPod

    # --- æœ€ç»ˆå…œåº• ---
    - domain_wildcard:
        match: '*'
        value: Default

  public_ip_lookup_url: https://ifconfig.me/ip

# --- ç­–ç•¥ç»„ ---
policy_groups:
  # 1. è‡ªåŠ¨æµ‹é€ŸèŠ‚ç‚¹ (åœ°åŒºåˆ†ç±»)
  - auto_test:
      name: é¦™æ¸¯èŠ‚ç‚¹
      policies: [å…¨éƒ¨èŠ‚ç‚¹]
      flatten: true
      filter: "ğŸ‡­ğŸ‡°|é¦™æ¸¯|Hong\\s*Kong|HongKong|HK(?!G)|HKG"
      interval: 600
      tolerance: 50
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/HongKong.png
  - auto_test:
      name: ç¾å›½èŠ‚ç‚¹
      policies: [å…¨éƒ¨èŠ‚ç‚¹]
      flatten: true
      filter: "ğŸ‡ºğŸ‡¸|ç¾å›½|United\\s*States|USA|US(?!A)|States|American"
      interval: 600
      tolerance: 50
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/UnitedStates.png
  - auto_test:
      name: å°æ¹¾èŠ‚ç‚¹
      policies: [å…¨éƒ¨èŠ‚ç‚¹]
      flatten: true
      filter: "ğŸ‡¹ğŸ‡¼|å°æ¹¾|Taiwan|TW(?!N)|Tai|TWN"
      interval: 600
      tolerance: 50
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Taiwan.png
  - auto_test:
      name: æ—¥æœ¬èŠ‚ç‚¹
      policies: [å…¨éƒ¨èŠ‚ç‚¹]
      flatten: true
      filter: "ğŸ‡¯ğŸ‡µ|æ—¥æœ¬|Japan|JP(?!N)|JPN"
      interval: 600
      tolerance: 50
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Japan.png
  - auto_test:
      name: ç‹®åŸèŠ‚ç‚¹
      policies: [å…¨éƒ¨èŠ‚ç‚¹]
      flatten: true
      filter: "ğŸ‡¸ğŸ‡¬|æ–°åŠ å¡|ç‹®åŸ|Singapore|SG(?!P)|SGP"
      interval: 600
      tolerance: 50
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Singapore.png
  - auto_test:
      name: éŸ©å›½èŠ‚ç‚¹
      policies: [å…¨éƒ¨èŠ‚ç‚¹]
      flatten: true
      filter: "ğŸ‡°ğŸ‡·|éŸ©å›½|Korea|KR(?!W)|KOR"
      interval: 600
      tolerance: 50
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Korea.png

  # 2. èŠ‚ç‚¹ç­›é€‰ä¸æ¥æº
  - select:
      name: å…¶ä»–èŠ‚ç‚¹
      policies: [å…¨éƒ¨èŠ‚ç‚¹]
      flatten: true
      filter: "^(?!.*(ğŸ‡­ğŸ‡°|é¦™æ¸¯|Hong\\s*Kong|HongKong|HK(?!G)|HKG|ğŸ‡ºğŸ‡¸|ç¾å›½|United\\s*States|USA|US(?!A)|States|American|ğŸ‡¹ğŸ‡¼|å°æ¹¾|Taiwan|TW(?!N)|Tai|TWN|ğŸ‡¯ğŸ‡µ|æ—¥æœ¬|Japan|JP(?!N)|JPN|ğŸ‡¸ğŸ‡¬|æ–°åŠ å¡|ç‹®åŸ|Singapore|SG(?!P)|SGP|ğŸ‡°ğŸ‡·|éŸ©å›½|Korea|KR(?!W)|KOR)).*$"
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/WorldMap.png
  - external:
      name: å…¨éƒ¨èŠ‚ç‚¹
      type: select
      urls:
        - https://sub.store/download/collection/AllServer?target=Egern
      icon: ğŸŒ¹

  # 3. è‡ªåŠ¨æµ‹é€Ÿä¼˜é€‰
  - auto_test:
      name: è‡ªåŠ¨ä¼˜é€‰
      policies: [å…¨éƒ¨èŠ‚ç‚¹]
      flatten: true
      interval: 600
      tolerance: 50
      icon: âš¡ï¸

  # 4. æ ¸å¿ƒç­–ç•¥ç»„ (æ‰‹åŠ¨é€‰æ‹©å…¥å£)
  - select:
      name: è‡ªé€‰ç­–ç•¥
      policies: [è‡ªåŠ¨ä¼˜é€‰, é¦™æ¸¯èŠ‚ç‚¹, ç¾å›½èŠ‚ç‚¹, ç‹®åŸèŠ‚ç‚¹, å°æ¹¾èŠ‚ç‚¹, æ—¥æœ¬èŠ‚ç‚¹, éŸ©å›½èŠ‚ç‚¹, å…¶ä»–èŠ‚ç‚¹, DIRECT]
      icon: ğŸ˜œ

  # 5. Apple æœåŠ¡åˆ†æµ (éšè—ç»„)
  - select:
      name: TestFlight
      policies: [ç¾å›½èŠ‚ç‚¹, è‡ªé€‰ç­–ç•¥]
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/TestFlight.png
      hidden: true
  - select:
      name: iCloud 
      policies: [DIRECT]
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/iCloud.png
      hidden: true
  - select:
      name: AppleProxy
      policies: [ç¾å›½èŠ‚ç‚¹, è‡ªé€‰ç­–ç•¥]
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/AppleProxy.png
      hidden: true

  # 6. å¸¸ç”¨æœåŠ¡åˆ†æµç­–ç•¥ (A-Z æ’åº)
  - select:
      name: AIGC
      policies: [ç¾å›½èŠ‚ç‚¹, è‡ªé€‰ç­–ç•¥]
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/ChatGPT.png
  - select:
      name: Apple
      policies: [DIRECT, è‡ªé€‰ç­–ç•¥]
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Apple.png
  - select:
      name: Bing
      policies: [ç¾å›½èŠ‚ç‚¹, è‡ªé€‰ç­–ç•¥]
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Bing.png
  - select:
      name: Disney
      policies: [ç‹®åŸèŠ‚ç‚¹, è‡ªé€‰ç­–ç•¥]
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Disney.png
  - select:
      name: GitHub
      policies: [é¦™æ¸¯èŠ‚ç‚¹, è‡ªé€‰ç­–ç•¥]
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/GitHub.png
  - select:
      name: Google
      policies: [ç¾å›½èŠ‚ç‚¹, è‡ªé€‰ç­–ç•¥]
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Google.png
  - select:
      name: HBO
      policies: [ç¾å›½èŠ‚ç‚¹, è‡ªé€‰ç­–ç•¥]
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/HBO.png
  - select:
      name: Microsoft
      policies: [DIRECT, è‡ªé€‰ç­–ç•¥]
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Microsoft.png
  - select:
      name: Netflix
      policies: [ç‹®åŸèŠ‚ç‚¹, è‡ªé€‰ç­–ç•¥]
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Netflix.png
  - select:
      name: PayPal
      policies: [ç¾å›½èŠ‚ç‚¹, è‡ªé€‰ç­–ç•¥]
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/PayPal.png
  - select:
      name: Spotify
      policies: [ç¾å›½èŠ‚ç‚¹, è‡ªé€‰ç­–ç•¥]
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Spotify.png
  - select:
      name: Telegram
      policies: [é¦™æ¸¯èŠ‚ç‚¹, è‡ªé€‰ç­–ç•¥]
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Telegram.png
  - select:
      name: TikTok
      policies: [æ—¥æœ¬èŠ‚ç‚¹, è‡ªé€‰ç­–ç•¥]
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/TikTok.png
  - select:
      name: Twitter
      policies: [é¦™æ¸¯èŠ‚ç‚¹, è‡ªé€‰ç­–ç•¥]
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Twitter.png
  - select:
      name: WeChat
      policies: [DIRECT, è‡ªé€‰ç­–ç•¥]
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/WeChat.png
  - select:
      name: YouTubeMusic
      policies: [é¦™æ¸¯èŠ‚ç‚¹, è‡ªé€‰ç­–ç•¥]
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/YouTubeMusic.png
  - select:
      name: YouTube
      policies: [é¦™æ¸¯èŠ‚ç‚¹, è‡ªé€‰ç­–ç•¥]
      flatten: true
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/YouTube.png

  # 7. å»å¹¿å‘Šç­–ç•¥ç»„
  - select:
      name: çŒæ€å¹¿å‘Š
      policies: [REJECT, DIRECT]
      flatten: false
      icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/AdBlock.png

# --- è§„åˆ™é›† ---
rules:
  # 1. å¹¿å‘Šæ‹¦æˆª
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/AdBlock.yaml
      policy: çŒæ€å¹¿å‘Š

  # 2. å±€åŸŸç½‘ä¸åŸºç¡€ç›´è¿
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Lan.yaml
      policy: DIRECT
  - domain_suffix:
      match: ntp.org
      policy: DIRECT

  # 3. Apple ç³»ç»ŸæœåŠ¡ç»†åˆ†
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Apple.yaml
      policy: DIRECT
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/AppleProxy.yaml
      policy: AppleProxy
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/TestFlight.yaml
      policy: TestFlight
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/iCloud.yaml
      policy: iCloud

  # 4. å…³é”®åº”ç”¨åˆ†æµ (A-Z æ’åº)
  - rule_set:
      match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/AIGC.yaml
      policy: AIGC
  - rule_set:
      match: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Bing/Bing.list
      policy: Bing
  - rule_set:
      match: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Disney/Disney.list
      policy: Disney
  - rule_set:
      match: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/GitHub/GitHub.list
      policy: GitHub
  - rule_set:
      match: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Google/Google.list
      policy: Google
  - rule_set:
      match: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/HBO/HBO.list
      policy: HBO
  - rule_set:
      match: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Microsoft/Microsoft.list
      policy: Microsoft
  - rule_set:
      match: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Netflix/Netflix.list
      policy: Netflix
  - rule_set:
      match: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/PayPal/PayPal.list
      policy: PayPal
  - rule_set:
      match: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Spotify/Spotify.list
      policy: Spotify
  - rule_set:
      match: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Telegram/Telegram.list
      policy: Telegram
  - rule_set:
      match: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/TikTok/TikTok.list
      policy: TikTok
  - rule_set:
      match: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Twitter/Twitter.list
      policy: Twitter
  - rule_set:
      match: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/WeChat/WeChat.list
      policy: WeChat
  - rule_set:
      match: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/YouTubeMusic/YouTubeMusic.list
      policy: YouTubeMusic
  - rule_set:
      match: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/YouTube/YouTube.list
      policy: YouTube

  # 5. å›½å†…ç›´è¿å…œåº•
  - domain_suffix:
      match: cn
      policy: DIRECT
  - geoip:
      match: CN
      policy: DIRECT
      no_resolve: true

  # 6. æœ€ç»ˆå…œåº•
  - default:
      policy: è‡ªé€‰ç­–ç•¥

# --- MITM é…ç½® ---
mitm:
  ca_p12: egern.p12
  ca_passphrase: egern

# --- æ¨¡å—é…ç½® ---
modules:
  - name: é¢æ¿åˆé›†
    url: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Module/Panel.yaml
    enabled: true
  - name: Sub-Store
    url: https://raw.githubusercontent.com/sub-store-org/Sub-Store/master/config/Egern.yaml
    enabled: true
  - name: ScriptHub
    url: https://raw.githubusercontent.com/Script-Hub-Org/Script-Hub/main/modules/script-hub.surge.sgmodule
    enabled: true
  - name: WeatherKit
    url: https://github.com/NSRingo/WeatherKit/releases/latest/download/iRingo.WeatherKit.sgmodule
    enabled: true
  - name: Spotify
    url: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Module/Spotify.yaml
    enabled: true
  - name: YouTube Enhance
    url: https://raw.githubusercontent.com/Maasea/sgmodule/master/YouTube.Enhance.sgmodule
    enabled: true
  - name: é›ªçƒå»å¹¿å‘Š
    url: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Module/Xueqiu.yaml
    enabled: true
  - name: é«˜å¾·åœ°å›¾å»å¹¿å‘Š
    url: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Module/AmapAdBlock.yaml
    enabled: true
  - name: ç™¾åº¦åœ°å›¾å»å¹¿å‘Š
    url: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Module/BaiduMapAdBlock.yaml
    enabled: true
  - name: BiliBiliå»å¹¿å‘Š
    url: https://raw.githubusercontent.com/app2smile/rules/master/module/bilibili.sgmodule
    enabled: true
  - name: KuGou
    url: https://raw.githubusercontent.com/Yu9191/Rewrite/refs/heads/main/KuGou.sgmodule
    enabled: true
  - name: KuWo
    url: https://raw.githubusercontent.com/Yuheng0101/X/main/Scripts/Kuwo/kuwo.sgmodule
    enabled: true
  - name: Ximalaya
    url: "http://script.hub/file/_start_/https://raw.githubusercontent.com/WeiGiegie/666/main/ximalaya.js/_end_/ximalaya.sgmodule?type=qx-rewrite&target=surge-module&del=true&jqEnabled=true"
    enabled: true