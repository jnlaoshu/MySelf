# > Testé…ç½®
# > é…ç½®ä¸‹è½½ğ”ğ‘ğ‹ï¼š https://raw.githubusercontent.com/jnlaoshu/MySelf/master/Egern/1.yaml
# > ğ”ğ©ğğšğ­ğ: 2025.02.02 21:00

# > å¼€å¯ipv6æ”¯æŒ
ipv6: true 

# > å…è®¸å¤–éƒ¨è¿æ¥é€šè¿‡ Wi-Fi è®¿é—®è®¾å¤‡ä¸Šçš„ä»£ç†
allow_external_connections: true

# > ä»…è™šæ‹Ÿç½‘æ¥å£æ¨¡å¼
vif_only: true

# > éšè— VPN å›¾æ ‡
hide_vpn_icon: false

# > DNS åŠ«æŒ
hijack_dns:
- '*:53'

# > æŒ‡å®šè‡ªå®šä¹‰çš„ GeoIP æ•°æ®åº“ URL
geoip_db_url: https://raw.githubusercontent.com/Loyalsoldier/geoip/release/Country.mmdb
# > æŒ‡å®šè‡ªå®šä¹‰çš„ ASN æ•°æ®åº“ URL
asn_db_url: https://raw.githubusercontent.com/P3TERX/GeoLite.mmdb/download/GeoLite2-ASN.mmdb

# > è‡ªå®šä¹‰çš„ä»£ç†å»¶è¿Ÿæµ‹è¯• URL
proxy_latency_test_url: http://cp.cloudflare.com/generate_204
# > è‡ªå®šä¹‰çš„ç›´è¿å»¶è¿Ÿæµ‹è¯• URL
direct_latency_test_url: http://www.apple.com/library/test/success.html

# > è™šæ‹Ÿç½‘ç»œæ¥å£ä¸ä½¿ç”¨é»˜è®¤çš„è·¯ç”±ï¼Œç”±å¤šä¸ªè¾ƒå°çš„è·¯ç”±åˆ‡åˆ†ç”¨äºè§£å†³æŸäº›é—®é¢˜ã€‚æ¯”å¦‚HomeKitçš„æ‘„åƒå¤´æ— æ³•ä½¿ç”¨çš„é—®é¢˜
compat_route: false

# > å¯ç”¨åç³»ç»Ÿä¼šé€šè¿‡éš§é“è·¯ç”±ç½‘ç»œæµé‡ï¼Œä½†ä¸ºç»´æŒé¢„æœŸè®¾å¤‡åŠŸèƒ½æ‰€å¿…éœ€çš„æŒ‡å®šç³»ç»ŸæœåŠ¡çš„æµé‡é™¤å¤–
include_all_networks: false

# > å¯ç”¨åç³»ç»Ÿå°†åŒ…å« Apple Push Notification æœåŠ¡ (APN) æµé‡ï¼Œä½†å‰ææ˜¯åŒ…å«æ‰€æœ‰ç½‘ç»œä¹Ÿå·²å¯ç”¨
include_apns: false

# > å¯ç”¨åç³»ç»Ÿä¼šåŒ…å«èœ‚çªç½‘ç»œæœåŠ¡ï¼Œå¦‚ Wi-Fi é€šè¯ã€å½©ä¿¡ã€çŸ­ä¿¡å’Œå¯è§†è¯­éŸ³é‚®ä»¶ï¼Œä½†å‰ææ˜¯åŒ…å«æ‰€æœ‰ç½‘ç»œä¹Ÿå·²å¯ç”¨ã€‚è¯¥å±æ€§ä¸ä¼šå½±å“ä»…ä½¿ç”¨èœ‚çªç½‘ç»œçš„æœåŠ¡ï¼ˆå¦‚ VoLTEï¼‰ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ’é™¤è¿™äº›æœåŠ¡
include_cellular_services: false

# > å¯ç”¨åç³»ç»Ÿå°†åŒ…å«ä¸æœ¬åœ°ç½‘ç»œä¸Šä¸»æœºï¼ˆå¦‚ AirPlayã€AirDrop å’Œ CarPlayï¼‰çš„ç½‘ç»œè¿æ¥ï¼Œä½†å‰ææ˜¯åŒ…å«æ‰€æœ‰ç½‘ç»œä¹Ÿå·²å¯ç”¨ã€‚é»˜è®¤å€¼æ˜¯ false
include_local_networks: false

dns:
  # [åŸºç¡€è®¾æ–½å±‚] å…ƒæ•°æ®è§£æ
  bootstrap:
    - tls://223.5.5.5            # é˜¿é‡Œ DoTï¼ˆæŠ— UDP æ±¡æŸ“ï¼‰
    - https://1.12.12.12/dns-query   # DNSPod DoHï¼ˆIP ç›´è¿é˜²åŠ«æŒï¼‰

  # [èµ„æºå±‚] ä¸Šæ¸¸æœåŠ¡å™¨æ‹“æ‰‘
  upstreams:
    Domestic:
      - https://doh.pub/dns-query                 # è…¾è®¯
      - quic://dns.alidns.com:8853                 # é˜¿é‡Œ DoQï¼ˆä½å»¶è¿Ÿï¼‰
    Foreign:
      - https://8.8.8.8/dns-query                  # Google DoHï¼ˆIP ç›´è¿ï¼‰
      - quic://dns.nextdns.io:853                  # NextDNSï¼ˆå…¨çƒä¼˜åŒ–ï¼‰

  # [ç­–ç•¥å±‚] åˆ†æµè§„åˆ™å¼•æ“
  forward:
    # 1. æŠ—æ±¡æŸ“åŠ é€Ÿï¼ˆå›½å†… CDN åŸŸåç›´è¿ï¼‰
    - cidr:
        match:
          - "119.29.29.29/24"     # DNSPod IP æ®µ
          - "223.5.5.0/24"        # é˜¿é‡Œ DNS IP æ®µ
        value: Domestic
        fast: true                # å¯ç”¨å¿«é€Ÿè·¯å¾„

    # 2. å¹¿å‘Š/è¿½è¸ªæ ¸æ‰“å‡»ï¼ˆå¤šæ¨¡å¼è”åˆæ‹¦æˆªï¼‰
    - regex:
        match: 
          - "(^|\.)(ad|ads|track|spy|analytics|cdn-adn)[0-9]*\."
          - "\.(adservice|doubleclick|omtrdc|pixel|click)\.[a-z]+$"
        value: quic://dns.adguard-dns.com:784
        cache: 7200              # ç»“æœç¼“å­˜ 2 å°æ—¶

    # 3. ä¸­æ–‡äº’è”ç½‘ä¸»æƒåŒºï¼ˆè¯­ä¹‰çº§åŒ¹é…ï¼‰
    - suffix:
        match:
          - "cn"
          - "ä¸­å›½"
          - "æ”¿åŠ¡"
          - "å…¬ç›Š"
        value: Domestic

    # 4. åŠ¨æ€ä»£ç†è§„åˆ™ï¼ˆæ™ºèƒ½æ›´æ–°ï¼‰
    - proxy_rule_set:
        match:
          - url: https://raw.githubusercontent.com/Loyalsoldier/surge-rules/release/ruleset/gfw.txt
            strategy: cidr          # æŒ‰ IP æ®µåŒ¹é…
            interval: 43200         # 12 å°æ—¶æ›´æ–°
          - url: https://raw.githubusercontent.com/v2fly/domain-list-community/release/data/gfw
            strategy: suffix        # æŒ‰åç¼€åŒ¹é…
            interval: 43200
        value: Foreign

    # 5. å…¨çƒåŒ–æ™ºèƒ½è·¯ç”±
    - wildcard:
        match: "*"
        value:
          - Domestic

# > æœ¬åœ°DNSè§£æçš„ä¸»æœºåæ˜ å°„
  hosts: 
    dns.alidns.com: 223.5.5.5, 223.6.6.6, 2400:3200:baba::1, 2400:3200::1 # https://dns.alidns.com/dns-query
    doh.pub: 1.12.12.12, 120.53.53.53 # https://doh.pub/dns-query
    dns.google: 8.8.8.8, 8.8.4.4, 2001:4860:4860::8888, 2001:4860:4860::8844 # https://dns.google/dns-query

# > æŸ¥è¯¢å…¬å…±IPåœ°å€çš„URLï¼Œç”¨äºè·å–æœ¬æœºçš„å…¬ç½‘IPåœ°å€  
  public_ip_lookup_url: https://ifconfig.me/ip  

# > ç­–ç•¥ç»„é…ç½®åˆ—è¡¨
policy_groups:
- external:
    name: AllServer
    type: select
    urls:
    - https://sub.store/download/collection/AllServer?target=Egern
    icon: ğŸŒ¹   
- select:
    name: Apple
    policies:
    - DIRECT
    - é¦™æ¸¯ä¼˜å…ˆ
    flatten: true
    icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Apple.png
- select:
    name: AIGC
    policies:
    - ç¾å›½ä¼˜å…ˆ
    flatten: true
    icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/ChatGPT.png    
- select:
    name: Google
    policies:
    - é¦™æ¸¯ä¼˜å…ˆ
    flatten: true
    icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Google.png
- select:
    name: Microsoft
    policies:
    - DIRECT
    - é¦™æ¸¯ä¼˜å…ˆ
    flatten: true
    icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Microsoft.png
- select:
    name: PayPal
    policies:
    - ç¾å›½èŠ‚ç‚¹
    flatten: true
    icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/PayPal.png
- select:
    name: Spotify
    policies:
    - ç¾å›½ä¼˜å…ˆ
    flatten: true
    icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Spotify.png    
- select:
    name: Telegram
    policies:
    - é¦™æ¸¯ä¼˜å…ˆ
    flatten: true
    icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Telegram.png
- select:
    name: TikTok
    policies:
    - æ—¥æœ¬ä¼˜å…ˆ
    flatten: true
    icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/TikTok.png    
- select:
    name: Twitter
    policies:
    - é¦™æ¸¯ä¼˜å…ˆ
    flatten: true
    icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Twitter.png
- select:
    name: WeChat
    policies:
    - DIRECT
    - é¦™æ¸¯ä¼˜å…ˆ
    flatten: true
    icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/WeChat.png
- select:
    name: YouTube
    policies:
    - é¦™æ¸¯ä¼˜å…ˆ
    flatten: true
    icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/YouTube.png
- auto_test:
    name: é¦™æ¸¯èŠ‚ç‚¹
    policies:
    - AllServer
    flatten: true
    filter: ğŸ‡­ğŸ‡°|æ¸¯|é¦™æ¸¯|HK|Hong
    icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/HongKong.png
- auto_test:
    name: ç¾å›½èŠ‚ç‚¹
    policies:
    - AllServer
    flatten: true
    filter: ğŸ‡ºğŸ‡¸|ç¾|ç¾å›½|US|States|American
    icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/UnitedStates.png
- auto_test:
    name: å°æ¹¾èŠ‚ç‚¹
    policies:
    - AllServer
    flatten: true
    filter: ğŸ‡¹ğŸ‡¼|å°|å°æ¹¾|TW|Tai
    icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Taiwan.png
- auto_test:
    name: æ—¥æœ¬èŠ‚ç‚¹
    policies:
    - AllServer
    flatten: true
    filter: ğŸ‡¯ğŸ‡µ|æ—¥|æ—¥æœ¬|JP|Japan
    icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Japan.png
- auto_test:
    name: ç‹®åŸèŠ‚ç‚¹
    policies:
    - AllServer
    flatten: true
    filter: ğŸ‡¸ğŸ‡¬|æ–°|æ–°åŠ å¡|ç‹®åŸ|SG|Singapore
    icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Singapore.png
- auto_test:
    name: éŸ©å›½èŠ‚ç‚¹
    policies:
    - AllServer
    flatten: true
    filter: ğŸ‡°ğŸ‡·|éŸ©|éŸ©å›½|KR|KOR|Korea
    icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/Korea.png    
- select:
    name: å…¶ä»–èŠ‚ç‚¹
    policies:
    - AllServer
    flatten: true
    filter: ^((?!ğŸ‡­ğŸ‡°|æ¸¯|HK|Hong|ğŸ‡¹ğŸ‡¼|å°|TW|Tai|ğŸ‡¯ğŸ‡µ|æ—¥|JP|Japan|ğŸ‡¸ğŸ‡¬|å¡|ç‹®åŸ|SG|Singapore|ğŸ‡°ğŸ‡·|éŸ©|KR|KOR|Korea|ğŸ‡ºğŸ‡¸|ç¾|US|States|American|Music).)*$
    icon: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/image/WorldMap.png
- select:
    name: é¦™æ¸¯ä¼˜å…ˆ
    policies:
    - é¦™æ¸¯èŠ‚ç‚¹
    - ç¾å›½èŠ‚ç‚¹
    - ç‹®åŸèŠ‚ç‚¹
    - å°æ¹¾èŠ‚ç‚¹
    - æ—¥æœ¬èŠ‚ç‚¹
    - éŸ©å›½èŠ‚ç‚¹
    - å…¶ä»–èŠ‚ç‚¹
    icon: ğŸ˜œ
- select:
    name: ç¾å›½ä¼˜å…ˆ
    policies:
    - ç¾å›½èŠ‚ç‚¹
    - é¦™æ¸¯èŠ‚ç‚¹
    - ç‹®åŸèŠ‚ç‚¹
    - å°æ¹¾èŠ‚ç‚¹
    - æ—¥æœ¬èŠ‚ç‚¹
    - éŸ©å›½èŠ‚ç‚¹
    - å…¶ä»–èŠ‚ç‚¹
    icon: ğŸ¤£
- select:
    name: æ—¥æœ¬ä¼˜å…ˆ
    policies:
    - æ—¥æœ¬èŠ‚ç‚¹    
    - ç¾å›½èŠ‚ç‚¹
    - å°æ¹¾èŠ‚ç‚¹    
    - éŸ©å›½èŠ‚ç‚¹
    - ç‹®åŸèŠ‚ç‚¹
    - é¦™æ¸¯èŠ‚ç‚¹
    - å…¶ä»–èŠ‚ç‚¹
    icon: ğŸ˜Š

# > ä»£ç†è§„åˆ™åˆ—è¡¨
rules:
- rule_set:
    match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/AppleProxy.yaml
    policy: ç¾å›½ä¼˜å…ˆ
- rule_set:
    match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Apple.yaml
    policy: Apple	
- rule_set:
    match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/AIGC.yaml
    policy: AIGC 
- rule_set:
    match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Bing.yaml
    policy: ç¾å›½ä¼˜å…ˆ
- rule_set:
    match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Google.yaml
    policy: Google
- rule_set:
    match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Microsoft.yaml
    policy: Microsoft
- rule_set:
    match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/PayPal.yaml
    policy: PayPal    
- rule_set:
    match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Spotify.yaml
    policy: Spotify
- rule_set:
    match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Telegram.yaml
    policy: Telegram
- rule_set:
    match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/TikTok.yaml
    policy: TikTok	
- rule_set:
    match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/Twitter.yaml
    policy: Twitter
- rule_set:
    match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/WeChat.yaml
    policy: WeChat    
- rule_set:
    match: https://raw.githubusercontent.com/jnlaoshu/MySelf/main/Egern/Rule/YouTube.yaml
    policy: YouTube
- geoip:
    match: CN
    policy: DIRECT
- default:
    policy: é¦™æ¸¯ä¼˜å…ˆ

# > MITM é…ç½®
mitm:
  enabled: true
  ca_p12: egern.p12
  ca_passphrase: egern
